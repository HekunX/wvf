(function(u,S){typeof exports=="object"&&typeof module<"u"?S(exports):typeof define=="function"&&define.amd?define(["exports"],S):(u=typeof globalThis<"u"?globalThis:u||self,S(u.webview={}))})(this,function(u){"use strict";u.DotNet=void 0,function(r){const s=[],c="__jsObjectId",l="__dotNetObject",d="__byte[]",k="__dotNetStream",L="__jsStreamReferenceLength";let y,p;class j{constructor(e){this._jsObject=e,this._cachedFunctions=new Map}findFunction(e){const t=this._cachedFunctions.get(e);if(t)return t;let o=this._jsObject,i;if(e.split(".").forEach(a=>{if(a in o)i=o,o=o[a];else throw new Error(`Could not find '${e}' ('${a}' was undefined).`)}),o instanceof Function)return o=o.bind(i),this._cachedFunctions.set(e,o),o;throw new Error(`The value '${e}' is not a function.`)}getWrappedObject(){return this._jsObject}}const O=0,m={[O]:new j(window)};m[O]._cachedFunctions.set("import",n=>(typeof n=="string"&&n.startsWith("./")&&(n=new URL(n.substr(2),document.baseURI).toString()),import(n)));let J=1;function U(n){const e=new z(n);return y===void 0?y=e:y&&(y=null),e}r.attachDispatcher=U;function F(n){s.push(n)}r.attachReviver=F;function K(n,e,...t){return C().invokeDotNetStaticMethod(n,e,...t)}r.invokeMethod=K;function V(n,e,...t){return C().invokeDotNetStaticMethodAsync(n,e,...t)}r.invokeMethodAsync=V;function N(n){if(n&&typeof n=="object"){m[J]=new j(n);const e={[c]:J};return J++,e}throw new Error(`Cannot create a JSObjectReference from the value '${n}'.`)}r.createJSObjectReference=N;function B(n){let e=-1;if(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n instanceof Blob)e=n.size;else if(n.buffer instanceof ArrayBuffer){if(n.byteLength===void 0)throw new Error(`Cannot create a JSStreamReference from the value '${n}' as it doesn't have a byteLength.`);e=n.byteLength}else throw new Error("Supplied value is not a typed array or blob.");const t={[L]:e};try{const o=N(n);t[c]=o[c]}catch{throw new Error(`Cannot create a JSStreamReference from the value '${n}'.`)}return t}r.createJSStreamReference=B;function W(n){const e=n&&n[c];typeof e=="number"&&R(e)}r.disposeJSObjectReference=W;function b(n,e){p=n;const t=e?JSON.parse(e,(o,i)=>s.reduce((a,f)=>f(o,a),i)):null;return p=void 0,t}function C(){if(y===void 0)throw new Error("No call dispatcher has been set.");if(y===null)throw new Error("There are multiple .NET runtimes present, so a default dispatcher could not be resolved. Use DotNetObject to invoke .NET instance methods.");return y}let g;(function(n){n[n.Default=0]="Default",n[n.JSObjectReference=1]="JSObjectReference",n[n.JSStreamReference=2]="JSStreamReference",n[n.JSVoidResult=3]="JSVoidResult"})(g=r.JSCallResultType||(r.JSCallResultType={}));class z{constructor(e){this._dotNetCallDispatcher=e,this._byteArraysToBeRevived=new Map,this._pendingDotNetToJSStreams=new Map,this._pendingAsyncCalls={},this._nextAsyncCallId=1}getDotNetCallDispatcher(){return this._dotNetCallDispatcher}invokeJSFromDotNet(e,t,o,i){const a=b(this,t),h=_(e,i)(...a||[]),w=M(h,o);return w==null?null:v(this,w)}beginInvokeJSFromDotNet(e,t,o,i,a){const f=new Promise(h=>{const w=b(this,o),X=_(t,a)(...w||[]);h(X)});e&&f.then(h=>v(this,[e,!0,M(h,i)])).then(h=>this._dotNetCallDispatcher.endInvokeJSFromDotNet(e,!0,h),h=>this._dotNetCallDispatcher.endInvokeJSFromDotNet(e,!1,JSON.stringify([e,!1,q(h)])))}endInvokeDotNetFromJS(e,t,o){const i=t?b(this,o):new Error(o);this.completePendingCall(parseInt(e,10),t,i)}invokeDotNetStaticMethod(e,t,...o){return this.invokeDotNetMethod(e,t,null,o)}invokeDotNetStaticMethodAsync(e,t,...o){return this.invokeDotNetMethodAsync(e,t,null,o)}invokeDotNetMethod(e,t,o,i){if(this._dotNetCallDispatcher.invokeDotNetFromJS){const a=v(this,i),f=this._dotNetCallDispatcher.invokeDotNetFromJS(e,t,o,a);return f?b(this,f):null}throw new Error("The current dispatcher does not support synchronous calls from JS to .NET. Use invokeDotNetMethodAsync instead.")}invokeDotNetMethodAsync(e,t,o,i){if(e&&o)throw new Error(`For instance method calls, assemblyName should be null. Received '${e}'.`);const a=this._nextAsyncCallId++,f=new Promise((h,w)=>{this._pendingAsyncCalls[a]={resolve:h,reject:w}});try{const h=v(this,i);this._dotNetCallDispatcher.beginInvokeDotNetFromJS(a,e,t,o,h)}catch(h){this.completePendingCall(a,!1,h)}return f}receiveByteArray(e,t){this._byteArraysToBeRevived.set(e,t)}processByteArray(e){const t=this._byteArraysToBeRevived.get(e);return t?(this._byteArraysToBeRevived.delete(e),t):null}supplyDotNetStream(e,t){if(this._pendingDotNetToJSStreams.has(e)){const o=this._pendingDotNetToJSStreams.get(e);this._pendingDotNetToJSStreams.delete(e),o.resolve(t)}else{const o=new E;o.resolve(t),this._pendingDotNetToJSStreams.set(e,o)}}getDotNetStreamPromise(e){let t;if(this._pendingDotNetToJSStreams.has(e))t=this._pendingDotNetToJSStreams.get(e).streamPromise,this._pendingDotNetToJSStreams.delete(e);else{const o=new E;this._pendingDotNetToJSStreams.set(e,o),t=o.streamPromise}return t}completePendingCall(e,t,o){if(!this._pendingAsyncCalls.hasOwnProperty(e))throw new Error(`There is no pending async call with ID ${e}.`);const i=this._pendingAsyncCalls[e];delete this._pendingAsyncCalls[e],t?i.resolve(o):i.reject(o)}}function q(n){return n instanceof Error?`${n.message}
${n.stack}`:n?n.toString():"null"}function _(n,e){const t=m[e];if(t)return t.findFunction(n);throw new Error(`JS object instance with ID ${e} does not exist (has it been disposed?).`)}r.findJSFunction=_;function R(n){delete m[n]}r.disposeJSObjectReferenceById=R;class A{constructor(e,t){this._id=e,this._callDispatcher=t}invokeMethod(e,...t){return this._callDispatcher.invokeDotNetMethod(null,e,this._id,t)}invokeMethodAsync(e,...t){return this._callDispatcher.invokeDotNetMethodAsync(null,e,this._id,t)}dispose(){this._callDispatcher.invokeDotNetMethodAsync(null,"__Dispose",this._id,null).catch(t=>console.error(t))}serializeAsArg(){return{[l]:this._id}}}r.DotNetObject=A,F(function(e,t){if(t&&typeof t=="object"){if(t.hasOwnProperty(l))return new A(t[l],p);if(t.hasOwnProperty(c)){const o=t[c],i=m[o];if(i)return i.getWrappedObject();throw new Error(`JS object instance with Id '${o}' does not exist. It may have been disposed.`)}else if(t.hasOwnProperty(d)){const o=t[d],i=p.processByteArray(o);if(i===void 0)throw new Error(`Byte array index '${o}' does not exist.`);return i}else if(t.hasOwnProperty(k)){const o=t[k],i=p.getDotNetStreamPromise(o);return new G(i)}}return t});class G{constructor(e){this._streamPromise=e}stream(){return this._streamPromise}async arrayBuffer(){return new Response(await this.stream()).arrayBuffer()}}class E{constructor(){this.streamPromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}function M(n,e){switch(e){case g.Default:return n;case g.JSObjectReference:return N(n);case g.JSStreamReference:return B(n);case g.JSVoidResult:return null;default:throw new Error(`Invalid JS call result type '${e}'.`)}}let D=0;function v(n,e){D=0,p=n;const t=JSON.stringify(e,Q);return p=void 0,t}function Q(n,e){if(e instanceof A)return e.serializeAsArg();if(e instanceof Uint8Array){p.getDotNetCallDispatcher().sendByteArray(D,e);const o={[d]:D};return D++,o}return e}}(u.DotNet||(u.DotNet={}));let S;S=u.DotNet.attachDispatcher({sendByteArray:P,beginInvokeDotNetFromJS:I,endInvokeJSFromDotNet:T});function P(r,s){const c=$(s);window.chrome.webview.postMessage(["ReceiveByteArrayFromJS",r,c])}function I(r,s,c,l,d){console.log("beginInvokeDotNetFromJS"),window.chrome.webview.postMessage(["beginInvokeDotNetFromJS",r?r.toString():null,s,c,l||0,d])}function T(r,s,c){console.log("beginInvokeDotNetFromJS"),window.chrome.webview.postMessage(["endInvokeJSFromDotNet",r?r.toString():null,s,c])}function $(r){const s=new Array(r.length);for(var c=0;c<r.length;c++)s[c]=String.fromCharCode(r[c]);return btoa(s.join(""))}function x(r){const s=atob(r),c=s.length,l=new Uint8Array(c);for(let d=0;d<c;d++)l[d]=s.charCodeAt(d);return l}window.chrome.webview.addEventListener("message",r=>{var s=JSON.parse(r.data);switch(s[0]){case"EndInvokeDotNet":{S.endInvokeDotNetFromJS(s[1],s[2],s[3]);break}case"BeginInvokeJS":{S.beginInvokeJSFromDotNet(s[1],s[2],s[3],s[4],s[5]);break}case"SendByteArrayToJS":{let c=s[1],l=s[2];const d=x(l);S.receiveByteArray(c,d);break}default:console.error(`不支持的消息类型${r.data}`)}}),window.DotNet=u.DotNet,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
